<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="users">
    <resultMap id="UserMap" type="KXUser">
        <result property="id"          column="id"            javaType="java.lang.Long"/>
        <result property="username"    column="username"      javaType="java.lang.String"/>
        <result property="password"    column="password"      javaType="java.lang.String"/>
        <result property="email"       column="email"         javaType="java.lang.String"/>
        
        <collection property="tasks"    ofType="KXTask"   select="tasks.selectTaskById"  column="id"/>
    </resultMap>

    <sql id="sql_users">
    <![CDATA[

        SELECT  u.ID         AS id,
                u.USERNAME   AS username,
                u.PASSWORD   AS password,
                u.EMAIL      AS email
        FROM    KX_USERS   u

        ]]>
    </sql>

    <select id = "getAll" resultMap = "UserMap">
        <include refid="sql_users"/>
    </select>

    <select id="selectUserById"  resultMap="UserMap">
        <include refid="sql_users"/>
        WHERE u.ID = #{value}
    </select>

    <insert id="insertUser" parameterType="KXUser" keyProperty="id" useGeneratedKeys="true" keyColumn="id">

    INSERT INTO KX_USERS (
                       username,
                       password,
                       email)
    VALUES (#{username},
            #{password},
            #{email})
    </insert>

    <update id="updateUser" parameterType="KXUser">

    UPDATE KX_USERS
    SET username = #{username},
        password = #{password},
        email    = #{email}
    WHERE id = #{id}
    </update>

    <delete id="deleteUserById" parameterType="java.lang.Integer">
        DELETE FROM KX_USERS
        WHERE id = #{value}
    </delete>



</mapper>